# Gemini 图像生成模型名称修正总结

## 问题说明

根据 Gemini API 官方文档（https://ai.google.dev/gemini-api/docs/image-generation），之前使用的图像生成模型名称不正确，导致模型生成失败。

## 修改内容

### 1. ✅ 更新模型配置 (services/modelConfig.ts)

**修改前**：
```typescript
IMAGE_MODELS = [
  {
    id: 'gemini-2.5-flash-image',  // ❌ 错误的模型名称
    name: 'Gemini 2.5 Flash (Nano Banana)',
    ...
  },
  {
    id: 'gemini-3-pro-image-preview',  // ❌ 错误的模型名称
    ...
  }
]
```

**修改后**：
```typescript
IMAGE_MODELS = [
  {
    id: 'gemini-2.0-flash-exp',  // ✅ 正确的模型名称
    name: 'Gemini 2.0 Flash Experimental',
    priority: 1,
    isDefault: true
  },
  {
    id: 'gemini-2.5-flash',  // ✅ 使用标准名称
    name: 'Gemini 2.5 Flash',
    priority: 2
  },
  {
    id: 'gemini-3-pro-preview',
    name: 'Gemini 3 Pro Preview',
    priority: 3
  },
  {
    id: 'gemini-3-flash',
    name: 'Gemini 3 Flash',
    priority: 4
  }
]
```

### 2. ✅ 更新所有硬编码的模型名称

已更新以下文件中的硬编码模型名称：

#### services/geminiService.ts
- Line 972: `gemini-2.5-flash-image` → `gemini-2.0-flash-exp`

#### App.tsx
- Line 476: 默认模型从 `gemini-2.5-flash-image` → `gemini-2.0-flash-exp`
- Line 1076, 1078: `gemini-2.5-flash-image` → `gemini-2.0-flash-exp`
- Line 1622, 1630, 2503, 2511, 2907: `gemini-2.5-flash-image` → `gemini-2.0-flash-exp`

#### components/Node.tsx
- Line 2930: STORYBOARD_IMAGE 节点的模型选择
- Line 2934: 默认图像生成模型列表
- 更新为：`gemini-2.0-flash-exp` 和 `gemini-3-pro-preview`

#### components/SketchEditor.tsx
- Line 213: 姿势生成
- Line 261: 图像编辑
- 更新为：`gemini-2.0-flash-exp`

#### services/videoStrategies.ts
- Line 183: 图像恢复
- 更新为：`gemini-2.0-flash-exp`

#### services/shotEnhancer.ts
- Line 78: 文本生成模型
- 添加 `getUserDefaultModel('text')` 调用，替换硬编码的 `gemini-2.5-flash`

## 新的图像生成模型列表

| 优先级 | 模型 ID | 名称 | 用途 |
|--------|---------|------|------|
| 1 | `gemini-2.0-flash-exp` | Gemini 2.0 Flash Experimental | 默认模型，快速稳定 |
| 2 | `gemini-2.5-flash` | Gemini 2.5 Flash | 稳定版本 |
| 3 | `gemini-3-pro-preview` | Gemini 3 Pro Preview | 最高质量 |
| 4 | `gemini-3-flash` | Gemini 3 Flash | 快速高质量 |

## API 调用示例

**正确的调用方式**：
```typescript
// 使用新的默认模型
const images = await generateImageFromText(
  prompt,
  'gemini-2.0-flash-exp',  // ✅ 正确的模型名称
  inputImages,
  { aspectRatio: '16:9' }
);

// 或者使用配置的默认模型
const images = await generateImageFromText(
  prompt,
  getUserDefaultModel('image'),  // ✅ 自动获取用户配置的默认模型
  inputImages,
  { aspectRatio: '16:9' }
);
```

## 验证方法

1. 打开设置 → 模型配置
2. 查看"图片生成"分类下的模型列表
3. 确认默认模型是 `gemini-2.0-flash-exp`
4. 执行任何图像生成操作
5. 检查 API 调试面板，确认使用的是正确的模型名称

## 预期效果

- ✅ 所有图像生成都使用正确的模型名称
- ✅ API 调用不再因为模型名称错误而失败
- ✅ 用户可以在设置中配置默认的图像生成模型
- ✅ 系统会按照用户配置的优先级自动选择模型

## 相关文档

- [Gemini API 官方文档 - 图像生成](https://ai.google.dev/gemini-api/docs/image-generation)
- [模型配置中心](services/modelConfig.ts)
- [API 调试指南](docs/API_LOGGING_GUIDE.md)
