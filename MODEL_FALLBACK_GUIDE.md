# æ¨¡å‹ä¼˜å…ˆçº§ä¸è‡ªåŠ¨é™çº§ç³»ç»Ÿ - ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†æ™ºèƒ½æ¨¡å‹åˆ‡æ¢åŠŸèƒ½ï¼Œå½“é¦–é€‰æ¨¡å‹é¢åº¦ç”¨å®Œæˆ–è°ƒç”¨å¤±è´¥æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå¯ç”¨æ¨¡å‹ï¼Œç¡®ä¿å·¥ä½œæµæŒç»­è¿è¡Œã€‚

## æ ¸å¿ƒåŠŸèƒ½

### 1. æ¨¡å‹ä¼˜å…ˆçº§é…ç½®

**ä½ç½®**: è®¾ç½® â†’ æ¨¡å‹ä¼˜å…ˆçº§ æ ‡ç­¾é¡µ

**åŠŸèƒ½**:
- ğŸ“‹ æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æ¨¡å‹æŒ‰ä¼˜å…ˆçº§æ’åº
- â¬†ï¸â¬‡ï¸ è°ƒæ•´æ¨¡å‹ä¼˜å…ˆçº§é¡ºåº
- ğŸ”„ é‡ç½®ä¸ºé»˜è®¤æ¨èé…ç½®
- ğŸ“Š æŸ¥çœ‹æ¨¡å‹å¥åº·çŠ¶æ€å’ŒæˆåŠŸç‡

### 2. è‡ªåŠ¨é™çº§æœºåˆ¶

**è§¦å‘æ¡ä»¶**:
- âœ… æ¨¡å‹é…é¢ç”¨å®Œ (quota exceeded)
- âœ… API è°ƒç”¨å¤±è´¥ (429, 503, ç­‰é”™è¯¯)
- âœ… è¿ç»­å¤±è´¥ 3 æ¬¡è‡ªåŠ¨è·³è¿‡è¯¥æ¨¡å‹

**é™çº§ç­–ç•¥**:
```
é¦–é€‰æ¨¡å‹ (å¤±è´¥)
    â†“
ç¬¬2ä¼˜å…ˆçº§æ¨¡å‹ (å¤±è´¥)
    â†“
ç¬¬3ä¼˜å…ˆçº§æ¨¡å‹ (æˆåŠŸ âœ“)
```

### 3. æ¨¡å‹å¥åº·ç›‘æ§

**å¥åº·çŠ¶æ€æŒ‡ç¤º**:
- ğŸŸ¢ **å¥åº·** - æ¨¡å‹æ­£å¸¸è¿è¡Œï¼ŒæˆåŠŸç‡é«˜
- ğŸŸ¡ **å¶å°”å¤±è´¥** - æœ‰å¤±è´¥è®°å½•ï¼Œä½†ä»å¯ç”¨
- ğŸ”´ **ä¸å¯ç”¨** - è¿ç»­å¤±è´¥3æ¬¡ï¼Œè‡ªåŠ¨è·³è¿‡

**ç»Ÿè®¡ä¿¡æ¯**:
- æˆåŠŸç‡ (%)
- è¿ç»­å¤±è´¥æ¬¡æ•°
- æœ€åä¸€æ¬¡é”™è¯¯æ—¶é—´

## ä½¿ç”¨æ–¹æ³•

### è®¾ç½®æ¨¡å‹ä¼˜å…ˆçº§

1. æ‰“å¼€è®¾ç½®é¢æ¿
2. åˆ‡æ¢åˆ°"æ¨¡å‹ä¼˜å…ˆçº§"æ ‡ç­¾
3. é€‰æ‹©è¦è°ƒæ•´çš„ç±»åˆ«ï¼ˆå›¾ç‰‡/è§†é¢‘/æ–‡æœ¬/éŸ³é¢‘ï¼‰
4. ä½¿ç”¨ â¬†ï¸â¬‡ï¸ æŒ‰é’®è°ƒæ•´é¡ºåº
5. ç‚¹å‡»"ä¿å­˜è®¾ç½®"

### æ¨èé…ç½®ç­–ç•¥

#### å›¾ç‰‡ç”Ÿæˆæ¨¡å‹
```
1. Imagen 4.0 Ultra      - æœ€é«˜è´¨é‡ï¼Œé€‚åˆæœ€ç»ˆè¾“å‡º
2. Imagen 4.0            - é«˜è´¨é‡ï¼Œç”Ÿäº§ç¯å¢ƒæ¨è
3. Imagen 4.0 Fast       - å¿«é€Ÿç”Ÿæˆï¼Œé€‚åˆé¢„è§ˆ
4. Gemini 3 Pro Image    - å¤šæ¨¡æ€ç†è§£
5. Gemini 2.5 Flash Image - å¤‡ç”¨æ–¹æ¡ˆ
```

#### æ–‡æœ¬ç”Ÿæˆæ¨¡å‹ (LLM)
```
1. Gemini 3 Pro          - æœ€å¼ºæ¨ç†ï¼Œå¤æ‚ä»»åŠ¡
2. Gemini 3 Pro Preview  - æ–°åŠŸèƒ½é¢„è§ˆ
3. Gemini 3 Flash        - å¿«é€Ÿå“åº”
4. Gemini 2.5 Flash      - ç¨³å®šå¤‡ç”¨
```

#### è§†é¢‘ç”Ÿæˆæ¨¡å‹
```
1. Veo 3.1               - ä¸“ä¸šè´¨é‡
2. Veo 3.1 Fast          - å¿«é€Ÿç”Ÿæˆ
3. Veo 3.0 Fast          - ç¨³å®šå¤‡ç”¨
4. Wan 2.1               - åŠ¨ç”»é£æ ¼
```

### è‡ªåŠ¨é™çº§é€šçŸ¥

å½“ç³»ç»Ÿè‡ªåŠ¨åˆ‡æ¢æ¨¡å‹æ—¶ï¼Œä¼šåœ¨å³ä¸Šè§’å¼¹å‡ºé€šçŸ¥ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ£ å›¾ç‰‡ç”Ÿæˆ 14:30:25           â”‚
â”‚                                 â”‚
â”‚ æ¨¡å‹ imagen-4.0-ultra é¢åº¦ç”¨å®Œ  â”‚
â”‚ å·²è‡ªåŠ¨åˆ‡æ¢è‡³ imagen-4.0        â”‚
â”‚                        [Ã—]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€æœ¯ç»†èŠ‚

### é…é¢é”™è¯¯æ£€æµ‹

ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ä»¥ä¸‹é”™è¯¯ï¼š
- `quota exceeded`
- `limit exceeded`
- `rate limit`
- `insufficient credits`
- HTTP 429 (Too Many Requests)
- Billing ç›¸å…³é”™è¯¯

### æ¨¡å‹ç»Ÿè®¡å­˜å‚¨

- å­˜å‚¨ä½ç½®: `localStorage`
- Key: `model_usage_stats`
- è®°å½•å†…å®¹:
  - æˆåŠŸæ¬¡æ•°
  - å¤±è´¥æ¬¡æ•°
  - è¿ç»­å¤±è´¥æ¬¡æ•°
  - æœ€åé”™è¯¯ä¿¡æ¯
  - æœ€åé”™è¯¯æ—¶é—´

### è‡ªåŠ¨æ¢å¤æœºåˆ¶

å½“æ¨¡å‹è¿ç»­å¤±è´¥3æ¬¡åä¼šè¢«æ ‡è®°ä¸º"ä¸å¯ç”¨"å¹¶è‡ªåŠ¨è·³è¿‡ã€‚
1å°æ—¶åè‡ªåŠ¨æ¢å¤ï¼Œé‡æ–°å°è¯•ä½¿ç”¨ã€‚

### æ‰‹åŠ¨é‡ç½®ç»Ÿè®¡

åœ¨è®¾ç½®é¢æ¿åº•éƒ¨ç‚¹å‡»"é‡ç½®æ‰€æœ‰ç»Ÿè®¡"å¯ä»¥ï¼š
- æ¸…é™¤æ‰€æœ‰å¤±è´¥è®°å½•
- é‡ç½®å¥åº·çŠ¶æ€
- é‡æ–°å¯ç”¨æ‰€æœ‰æ¨¡å‹

## æœ€ä½³å®è·µ

### 1. å¹³è¡¡è´¨é‡å’Œé€Ÿåº¦

**åœºæ™¯A - æœ€ç»ˆäº§å“æ¸²æŸ“**
```
1. Imagen 4.0 Ultra (æœ€é«˜è´¨é‡)
2. Imagen 4.0 (å¤‡ç”¨)
3. Imagen 4.0 Fast (ç´§æ€¥å¤‡ç”¨)
```

**åœºæ™¯B - å¿«é€ŸåŸå‹è®¾è®¡**
```
1. Imagen 4.0 Fast (å¿«é€Ÿ)
2. Gemini 2.5 Flash Image (æ›´å¿«é€Ÿ)
```

### 2. æˆæœ¬æ§åˆ¶

å°†å…è´¹/ä½æˆæœ¬æ¨¡å‹æ”¾åœ¨å‰é¢ï¼š
```
1. Gemini 2.5 Flash Image (å…è´¹é¢åº¦é«˜)
2. Imagen 4.0 Fast (æˆæœ¬è¾ƒä½)
3. Imagen 4.0 Ultra (ä»…åœ¨å¿…è¦æ—¶)
```

### 3. é«˜å¯ç”¨æ€§é…ç½®

é€‰æ‹©å¤šä¸ªä¸åŒæä¾›å•†çš„æ¨¡å‹ä½œä¸ºå¤‡ç”¨ï¼š
```
1. Imagen 4.0 (Google)
2. Gemini 3 Pro Image (Google)
3. [å…¶ä»–æä¾›å•†æ¨¡å‹]
```

## æ•…éšœæ’é™¤

### é—®é¢˜ï¼šæ¨¡å‹é¢‘ç¹é™çº§

**å¯èƒ½åŸå› **:
- é¦–é€‰æ¨¡å‹é…é¢ä¸è¶³
- ç½‘ç»œä¸ç¨³å®š
- API Key æƒé™é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥è´¦æˆ·é…é¢
2. è°ƒæ•´ä¼˜å…ˆçº§ï¼Œå°†å¯ç”¨æ¨¡å‹æå‰
3. é‡ç½®ç»Ÿè®¡é‡æ–°è¯„ä¼°

### é—®é¢˜ï¼šæ‰€æœ‰æ¨¡å‹éƒ½å¤±è´¥

**é”™è¯¯æç¤º**: "æ‰€æœ‰å›¾ç‰‡æ¨¡å‹å‡ä¸å¯ç”¨"

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ API Key é…ç½®
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. æŸ¥çœ‹è°ƒè¯•é¢æ¿çš„é”™è¯¯æ—¥å¿—
4. ç¡®è®¤è´¦æˆ·çŠ¶æ€æ­£å¸¸

### é—®é¢˜ï¼šé™çº§é€šçŸ¥è¿‡å¤š

**è§£å†³æ–¹æ¡ˆ**:
1. è°ƒæ•´æ¨¡å‹ä¼˜å…ˆçº§ï¼Œä½¿ç”¨æ›´ç¨³å®šçš„æ¨¡å‹
2. ç‚¹å‡»é€šçŸ¥å…³é—­æŒ‰é’®æ‰‹åŠ¨å…³é—­
3. é€šçŸ¥ä¼šåœ¨5ç§’åè‡ªåŠ¨æ¶ˆå¤±

## API é›†æˆ

### åœ¨ä»£ç ä¸­ä½¿ç”¨è‡ªåŠ¨é™çº§

```typescript
import { generateImageWithFallback } from './services/geminiServiceWithFallback';

// è‡ªåŠ¨é™çº§çš„å›¾ç‰‡ç”Ÿæˆ
const images = await generateImageWithFallback(
  prompt,
  'imagen-4.0-ultra', // é¦–é€‰æ¨¡å‹
  inputImages,
  { aspectRatio: '16:9', count: 1 },
  { nodeId: node.id, nodeType: node.type }
);
```

### è‡ªå®šä¹‰é™çº§é…ç½®

```typescript
import { executeWithFallback } from './services/modelFallback';

const result = await executeWithFallback(
  async (modelId) => {
    // ä½ çš„APIè°ƒç”¨
    return await myApiCall(modelId);
  },
  initialModel,
  {
    maxAttempts: 3,
    enableFallback: true,
    onModelFallback: (from, to, reason) => {
      console.log(`é™çº§: ${from} -> ${to} (${reason})`);
    }
  }
);
```

## æ•°æ®ç»“æ„

### ModelInfo

```typescript
interface ModelInfo {
  id: string;              // æ¨¡å‹ID
  name: string;            // æ˜¾ç¤ºåç§°
  category: ModelCategory; // 'image' | 'video' | 'text' | 'audio'
  priority: number;        // ä¼˜å…ˆçº§ (1=æœ€é«˜)
  quality: number;         // è´¨é‡è¯„åˆ† (1-10)
  speed: number;           // é€Ÿåº¦è¯„åˆ† (1-10)
  cost: number;            // æˆæœ¬è¯„åˆ† (1-10, 10=æœ€ä¾¿å®œ)
  capabilities: string[];  // èƒ½åŠ›åˆ—è¡¨
  description: string;     // æè¿°
  tags: string[];          // æ ‡ç­¾
  isDefault?: boolean;     // æ˜¯å¦ä¸ºé»˜è®¤æ¨è
}
```

### ModelUsageStats

```typescript
interface ModelUsageStats {
  modelId: string;
  successCount: number;
  failureCount: number;
  lastError?: string;
  lastErrorTime?: number;
  consecutiveFailures: number;
}
```

## æœªæ¥è§„åˆ’

- [ ] æ”¯æŒè‡ªå®šä¹‰æ¨¡å‹ï¼ˆç¬¬ä¸‰æ–¹ APIï¼‰
- [ ] æ¨¡å‹æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] æˆæœ¬ä¼°ç®—å’Œé¢„ç®—æ§åˆ¶
- [ ] A/B æµ‹è¯•ä¸åŒæ¨¡å‹æ•ˆæœ
- [ ] æ™ºèƒ½æ¨èæœ€ä¼˜æ¨¡å‹ç»„åˆ
- [ ] è·¨åŒºåŸŸæ¨¡å‹é€‰æ‹©

## åé¦ˆä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼åé¦ˆï¼š
- GitHub Issues
- è°ƒè¯•é¢æ¿å¯¼å‡ºæ—¥å¿—
- è”ç³»å¼€å‘å›¢é˜Ÿ

---

**æœ€åæ›´æ–°**: 2025-01-11
**ç‰ˆæœ¬**: 1.0.0
